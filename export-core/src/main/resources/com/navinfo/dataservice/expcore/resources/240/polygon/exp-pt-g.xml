<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <!--///////////////////////////////////////////////////公交/////////////////////////////////////////////////////////-->
    <feature name="PT_FEATURE">

        <step value="13">
            <sql condition="polygon">
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_PT_POI
                          (PID)
                          (SELECT PID FROM PT_POI
                            WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE');
                        ]]></sql>
        </step>

		<step value="19">
            <sql>
                <![CDATA[
                        INSERT /*+ append */
                         INTO TEMP_PT_PLATFORM
                           (PID)
                           (SELECT DISTINCT P.PID
                              FROM PT_PLATFORM P,TEMP_PT_POI T
                             WHERE P.POI_PID=T.PID);
                        ]]></sql>
        </step>
        
        <step value="22">
        	<!-- TEMP_PT_TRANSFER -->
            <sql>
                <![CDATA[
                        INSERT /*+ append */
                         INTO TEMP_PT_TRANSFER
                           (PID)
                           (SELECT P.TRANSFER_ID
                              FROM PT_TRANSFER P  WHERE P.TRANSFER_TYPE=0 AND P.POI_FIR IN (SELECT PID FROM TEMP_PT_POI T)
                               AND P.POI_SEC IN (SELECT PID FROM TEMP_PT_POI T));
                        ]]></sql>

			<sql>
                <![CDATA[
                        INSERT /*+ append */
                         INTO TEMP_PT_TRANSFER
                           (PID)
                           (SELECT P.TRANSFER_ID
                              FROM PT_TRANSFER P  WHERE P.TRANSFER_TYPE=1 AND P.PLATFORM_FIR IN (SELECT PID FROM TEMP_PT_PLATFORM T)
                               AND P.PLATFORM_SEC IN (SELECT PID FROM TEMP_PT_PLATFORM T));
                        ]]></sql>
                        
          <!-- TEMP_PT_STRAND -->         
          <sql>
                <![CDATA[
                        INSERT /*+ append */
                         INTO TEMP_PT_STRAND
                           (PID)
                           (SELECT DISTINCT P.STRAND_PID
                              FROM PT_STRAND_PLATFORM P,TEMP_PT_PLATFORM T WHERE P.PLATFORM_PID=T.PID );
                        ]]></sql>              


        </step>
        <step value="25">
        	<!-- TEMP_PT_TRANSFER去重 -->
            <sql>
                <![CDATA[
                        DELETE FROM TEMP_PT_TRANSFER A
                     WHERE A.ROWID !=
                           (SELECT MAX(B.ROWID) FROM TEMP_PT_TRANSFER B WHERE A.PID = B.PID);
                        ]]></sql>
                        
             <!-- TEMP_PT_LINE -->
             <sql>
                <![CDATA[
                        INSERT /*+ append */
                         INTO TEMP_PT_LINE
                           (PID)
                           (SELECT DISTINCT P.LINE_ID
                              FROM TEMP_PT_STRAND T,PT_STRAND P WHERE P.PID=T.PID  );
                        ]]></sql>                   
        </step>
        
        <step value="28">
             <!-- TEMP_PT_SYSTEM -->
             <sql>
                <![CDATA[
                        INSERT /*+ append */
                         INTO TEMP_PT_SYSTEM
                           (PID)
                           (SELECT DISTINCT P.SYSTEM_ID
                              FROM TEMP_PT_LINE T,PT_LINE P WHERE P.PID=T.PID  );
                        ]]></sql>                   
        </step>
        
		<step value="31">
             <!-- TEMP_PT_COMPANY -->
             <sql>
                <![CDATA[
                        INSERT /*+ append */
                         INTO TEMP_PT_COMPANY
                           (PID)
                           (SELECT DISTINCT P.COMPANY_ID
                              FROM TEMP_PT_SYSTEM T,PT_SYSTEM P WHERE P.SYSTEM_ID=T.PID  );
                        ]]></sql>                   
        </step>
        
        <step value="100">
            <!--//////////////////////////////////////////公交POI////////////////////////////////////////////////////////////-->
            <sql><![CDATA[SELECT P.* FROM PT_POI P,  TEMP_PT_POI R WHERE P.PID = R.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_POI_NAME P,  TEMP_PT_POI R WHERE P.POI_PID = R.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_POI_NAME_TONE P,PT_POI_NAME N,  TEMP_PT_POI R WHERE N.POI_PID = R.PID AND P.NAME_ID=N.NAME_ID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_POI_FLAG P,  TEMP_PT_POI R WHERE P.POI_PID = R.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_POI_PARENT P,  TEMP_PT_POI R WHERE P.PARENT_POI_PID = R.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_POI_CHILDREN P,PT_POI_PARENT PA,TEMP_PT_POI R WHERE PA.PARENT_POI_PID = R.PID AND P.GROUP_ID=PA.GROUP_ID;]]></sql>

            <!--//////////////////////////////////////////站台////////////////////////////////////////////////////////////-->
            <sql><![CDATA[SELECT P.* FROM PT_PLATFORM P, TEMP_PT_PLATFORM R WHERE P.PID = R.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_PLATFORM_NAME P, TEMP_PT_PLATFORM T WHERE P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_TRANSFER P,TEMP_PT_TRANSFER T  WHERE P.TRANSFER_ID =T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_PLATFORM_ACCESS P, TEMP_PT_PLATFORM T WHERE P.PLATFORM_ID=T.PID;]]></sql>

            <!--//////////////////////////////////////////公交线路////////////////////////////////////////////////////////////-->
            <sql><![CDATA[SELECT P.* FROM PT_LINE P,TEMP_PT_LINE T WHERE  P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_LINE_NAME P,TEMP_PT_LINE T WHERE  P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_STRAND P,TEMP_PT_STRAND T WHERE  P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_STRAND_NAME P,TEMP_PT_STRAND T WHERE  P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_STRAND_PLATFORM P, TEMP_PT_STRAND T WHERE  P.STRAND_PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_STRAND_SCHEDULE P,TEMP_PT_STRAND T WHERE  P.STRAND_PID=t.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_RUNTIME P,TEMP_PT_STRAND T WHERE  P.STRAND_PID=t.PID;]]></sql>
            
            <!--//////////////////////////////////////////公交公司和公交系统////////////////////////////////////////////////////////////-->
            <sql><![CDATA[SELECT P.* FROM PT_COMPANY P,TEMP_PT_COMPANY T WHERE P.COMPANY_ID = T.PID ;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_SYSTEM P,TEMP_PT_SYSTEM T WHERE P.SYSTEM_ID =T.PID;]]></sql>
            
            <!--//////////////////////////////////////////公交深度信息////////////////////////////////////////////////////////////-->
            <sql><![CDATA[SELECT P.* FROM PT_ETA_COMPANY P,TEMP_PT_COMPANY T WHERE  P.COMPANY_ID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_ETA_SYSTEM P,TEMP_PT_SYSTEM T WHERE P.SYSTEM_ID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_ETA_ACCESS P,  TEMP_PT_POI R WHERE P.POI_PID = R.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_ETA_STOP P,  TEMP_PT_POI R WHERE P.POI_PID = R.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM PT_ETA_LINE P,TEMP_PT_LINE T WHERE  P.PID=T.PID;]]></sql>
            
        </step>
        
        <step value="101">
        	<!--//////////////////////////////////////////公交POI////////////////////////////////////////////////////////////-->
            <sql><![CDATA[DELETE FROM PT_POI P WHERE P.PID IN (SELECT T.PID FROM TEMP_PT_POI T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_POI_NAME P WHERE P.POI_PID IN (SELECT T.PID FROM TEMP_PT_POI T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_POI_NAME_TONE P WHERE P.NAME_ID IN(SELECT T2.NAME_ID FROM PT_POI_NAME T2, TEMP_PT_POI T WHERE T2.POI_PID=T.PID);]]></sql>
            <sql><![CDATA[DELETE FROM PT_POI_FLAG P WHERE P.POI_PID IN (SELECT T.PID FROM TEMP_PT_POI T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_POI_PARENT P WHERE P.PARENT_POI_PID IN (SELECT T.PID FROM TEMP_PT_POI T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_POI_CHILDREN P WHERE P.GROUP_ID IN (SELECT T2.GROUP_ID FROM PT_POI_PARENT T2, TEMP_PT_POI T WHERE T2.PARENT_POI_PID=T.PID);]]></sql>

            <!--//////////////////////////////////////////站台////////////////////////////////////////////////////////////-->
            <sql><![CDATA[DELETE FROM PT_PLATFORM P WHERE P.PID IN (SELECT T.PID FROM TEMP_PT_PLATFORM T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_PLATFORM_NAME P WHERE P.PID IN (SELECT T.PID FROM TEMP_PT_PLATFORM T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_TRANSFER P WHERE P.TRANSFER_ID IN (SELECT T.PID FROM TEMP_PT_TRANSFER T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_PLATFORM_ACCESS P WHERE P.TRANSFER_ID IN (SELECT T.PID FROM TEMP_PT_TRANSFER T );]]></sql>

            <!--//////////////////////////////////////////公交线路////////////////////////////////////////////////////////////-->
            <sql><![CDATA[DELETE FROM PT_LINE P WHERE P.PID IN (SELECT T.PID FROM TEMP_PT_LINE T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_LINE_NAME P WHERE P.PID IN (SELECT T.PID FROM TEMP_PT_LINE T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_STRAND P WHERE P.PID IN (SELECT T.PID FROM TEMP_PT_STRAND T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_STRAND_NAME P WHERE P.PID IN (SELECT T.PID FROM TEMP_PT_STRAND T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_STRAND_PLATFORM P WHERE P.STRAND_PID IN (SELECT T.PID FROM TEMP_PT_STRAND T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_STRAND_SCHEDULE P WHERE P.STRAND_PID IN (SELECT T.PID FROM TEMP_PT_STRAND T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_RUNTIME P WHERE P.STRAND_PID IN (SELECT T.PID FROM TEMP_PT_STRAND T );]]></sql>
            
            <!--//////////////////////////////////////////公交公司和公交系统////////////////////////////////////////////////////////////-->
            <sql><![CDATA[DELETE FROM PT_COMPANY P WHERE P.COMPANY_ID IN (SELECT T.PID FROM TEMP_PT_COMPANY T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_SYSTEM P WHERE P.SYSTEM_ID IN (SELECT T.PID FROM TEMP_PT_SYSTEM T );]]></sql>
            
            <!--//////////////////////////////////////////公交深度信息////////////////////////////////////////////////////////////-->
            <sql><![CDATA[DELETE FROM PT_ETA_COMPANY P WHERE P.COMPANY_ID IN (SELECT T.PID FROM TEMP_PT_COMPANY T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_ETA_SYSTEM P WHERE P.SYSTEM_ID IN (SELECT T.PID FROM TEMP_PT_SYSTEM T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_ETA_ACCESS P WHERE P.POI_PID IN (SELECT T.PID FROM TEMP_PT_POI T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_ETA_STOP P WHERE P.POI_PID IN (SELECT T.PID FROM TEMP_PT_POI T );]]></sql>
            <sql><![CDATA[DELETE FROM PT_ETA_LINE P WHERE P.PID IN (SELECT T.PID FROM TEMP_PT_LINE T );]]></sql>
        </step>
        
    </feature>
</sqls>