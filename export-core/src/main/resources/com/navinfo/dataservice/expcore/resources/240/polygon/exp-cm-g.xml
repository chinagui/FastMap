<?xml version="1.0" encoding="UTF-8"?>
<!--索引需要重建-->
<sqls>
    <!--///////////////////////////////////////////////////市街图/////////////////////////////////////////////////////////-->
    <feature name="CMG">
        <!--
                               市街图提取原则:
            1.按geo提取face
            2.从face提取link(不考虑提取未组成face的孤立link)
            3.通过link提取两端的node
            4.提取其它信息
        -->
        <step value="7">
        	<!--按geo提取face -->
			<sql condition="polygon"><![CDATA[
                    INSERT /*+ append */
                    INTO TEMP_CMG_BUILDFACE
                      (PID)
                      (SELECT DISTINCT T.FACE_PID
                         FROM CMG_BUILDFACE T
                        WHERE SDO_ANYINTERACT(T.GEOMETRY,[polygon]) = 'TRUE');
                    ]]></sql>
		</step>
		
		<step value="10">
            <!--根据face提取link -->
            <sql><![CDATA[
                         INSERT /*+ append */
                         INTO TEMP_CMG_BUILDLINK
                           (PID)
                           (SELECT DISTINCT T.LINK_PID
                              FROM TEMP_CMG_BUILDFACE P, CMG_BUILDFACE_TOPO T
                             WHERE P.PID = T.FACE_PID);
                         ]]></sql>
        </step>
        
        <step value="19">
            <!--CMG_BUILDING并去重-->
            <sql><![CDATA[
            			INSERT /*+ append */
						INTO TEMP_CMG_BUILDING
						    (PID)
						    SELECT DISTINCT B.BUILDING_PID
						      FROM CMG_BUILDFACE B, TEMP_CMG_BUILDFACE T
						     WHERE B.FACE_PID = T.PID
						     AND B.BUILDING_PID !=0 AND B.BUILDING_PID !=-1;
						 ]]></sql>
        </step>

        <step value="22">
			<!--根据link提取node并去重 -->
            <sql><![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_CMG_BUILDNODE
                          (PID)
                          (SELECT P.S_NODE_PID FROM CMG_BUILDLINK P, TEMP_CMG_BUILDLINK T WHERE P.LINK_PID = T.PID
                            UNION
                           SELECT P.E_NODE_PID FROM CMG_BUILDLINK P, TEMP_CMG_BUILDLINK T WHERE P.LINK_PID = T.PID);
                        ]]></sql>
        </step>

        <step value="100">
            <!--提取数据表：-->
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDFACE P,TEMP_CMG_BUILDFACE T WHERE P.FACE_PID=T.PID; ]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDFACE_TOPO P,TEMP_CMG_BUILDFACE T WHERE P.FACE_PID=T.PID; ]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDFACE_TENANT P, TEMP_CMG_BUILDFACE T WHERE P.FACE_PID = T.PID;]]></sql>
            
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDING P, TEMP_CMG_BUILDING T WHERE P.PID = T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDING_3DICON P, TEMP_CMG_BUILDING T WHERE P.BUILDING_PID = T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDING_3DMODEL P, TEMP_CMG_BUILDING T WHERE P.BUILDING_PID = T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDING_NAME P, TEMP_CMG_BUILDING T WHERE P.BUILDING_PID = T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDING_POI P, TEMP_CMG_BUILDING T WHERE P.BUILDING_PID = T.PID;]]></sql>
            
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDLINK P, TEMP_CMG_BUILDLINK T WHERE P.LINK_PID = T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDLINK_MESH P, TEMP_CMG_BUILDLINK T WHERE P.LINK_PID = T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDNODE P, TEMP_CMG_BUILDNODE T WHERE P.NODE_PID = T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM CMG_BUILDNODE_MESH P, TEMP_CMG_BUILDNODE T WHERE P.NODE_PID = T.PID;]]></sql>

        </step>

        <step value="101">
            <!--删除数据表：-->
            <sql><![CDATA[DELETE FROM CMG_BUILDFACE P WHERE P.FACE_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDFACE T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDFACE_TOPO P WHERE P.FACE_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDFACE T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDFACE_TENANT P WHERE P.FACE_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDFACE T ); ]]></sql>
            
            <sql><![CDATA[DELETE FROM CMG_BUILDING P WHERE P.PID IN (SELECT T.PID FROM TEMP_CMG_BUILDING T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDING_3DICON P WHERE P.BUILDING_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDING T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDING_3DMODEL P WHERE P.BUILDING_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDING T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDING_NAME P WHERE P.BUILDING_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDING T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDING_POI P WHERE P.BUILDING_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDING T ); ]]></sql>
            
            <sql><![CDATA[DELETE FROM CMG_BUILDLINK P WHERE P.LINK_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDLINK T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDLINK_MESH P WHERE P.LINK_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDLINK T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDNODE P WHERE P.NODE_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDNODE T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CMG_BUILDNODE_MESH P WHERE P.NODE_PID IN (SELECT T.PID FROM TEMP_CMG_BUILDNODE T ); ]]></sql>

        </step>


        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_CMG_BUILDFACE
					  SELECT FACE_PID
					    FROM CMG_BUILDFACE A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM CMG_BUILDFACE  B WHERE A.FACE_PID = B.FACE_PID);
				]]></sql>

            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_CMG_BUILDING
					  SELECT PID
					    FROM CMG_BUILDING A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM CMG_BUILDING  B WHERE A.PID = B.PID);
				]]></sql>

            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_CMG_BUILDLINK
					  SELECT LINK_PID
					    FROM CMG_BUILDLINK A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM CMG_BUILDLINK  B WHERE A.LINK_PID = B.LINK_PID);
				]]></sql>

            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_CMG_BUILDNODE
					  SELECT NODE_PID
					    FROM CMG_BUILDNODE A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM CMG_BUILDNODE  B WHERE A.NODE_PID = B.NODE_PID);
				]]></sql>
        </step>

    </feature>


    <feature name="CM">
        <step value="7">
            <!--按geo提取face -->
	            <sql condition="polygon"><![CDATA[
	                    INSERT /*+ append */
	                    INTO TEMP_CM_BUILDFACE
	                      (PID)
	                      (SELECT DISTINCT T.FACE_PID
	                         FROM CM_BUILDFACE T
	                        WHERE SDO_ANYINTERACT(T.GEOMETRY,
	                                              [polygon]) = 'TRUE');
	                    ]]></sql>
        </step>
        
        <step value="10">
            <!--根据face提取link -->
            <sql><![CDATA[
                         INSERT /*+ append */
                         INTO TEMP_CM_BUILDLINK
                           (PID)
                           (SELECT T.LINK_PID
                              FROM TEMP_CM_BUILDFACE P, CM_BUILDFACE_TOPO T
                             WHERE P.PID = T.FACE_PID);
                         ]]></sql>
        </step>
        
        <step value="19">
            <!--CMG_BUILDING并去重-->
            <sql><![CDATA[
            			INSERT /*+ append */
						INTO TEMP_CM_BUILDING
						    (PID)
						    SELECT DISTINCT B.BUILDING_PID
						      FROM CM_BUILDFACE B, TEMP_CM_BUILDFACE T
						     WHERE B.FACE_PID = T.PID
						     AND B.BUILDING_PID !=0 AND B.BUILDING_PID !=-1;
						 ]]></sql>
        </step>

        <step value="22">
			<!--根据link提取node并去重 -->
            <sql><![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_CM_BUILDNODE
                          (PID)
                          (SELECT P.S_NODE_PID FROM CM_BUILDLINK P, TEMP_CM_BUILDLINK T WHERE P.LINK_PID = T.PID
                            UNION
                           SELECT P.E_NODE_PID FROM CM_BUILDLINK P, TEMP_CM_BUILDLINK T WHERE P.LINK_PID = T.PID);
                        ]]></sql>
        </step>

        <step value="100">
        
			<sql><![CDATA[SELECT P.* FROM CM_BUILDFACE P,TEMP_CM_BUILDFACE T WHERE P.FACE_PID=T.PID; ]]></sql>
            <sql><![CDATA[SELECT P.* FROM CM_BUILDFACE_TOPO P,TEMP_CM_BUILDFACE T WHERE P.FACE_PID=T.PID; ]]></sql>
            <sql><![CDATA[SELECT P.* FROM CM_BUILDING P, TEMP_CM_BUILDING F WHERE P.PID = F.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM CM_BUILDLINK P,TEMP_CM_BUILDLINK T WHERE P.LINK_PID=T.PID; ]]></sql>
            <sql><![CDATA[SELECT P.* FROM CM_BUILDLINK_MESH P,TEMP_CM_BUILDLINK T WHERE P.LINK_PID=T.PID; ]]></sql>
            <sql><![CDATA[SELECT P.* FROM CM_BUILDNODE P,TEMP_CM_BUILDNODE T WHERE P.NODE_PID=T.PID; ]]></sql>
            <sql><![CDATA[SELECT P.* FROM CM_BUILDNODE_MESH P,TEMP_CM_BUILDNODE T WHERE P.NODE_PID=T.PID; ]]></sql>

        </step>

        <step value="101">
        
            <sql><![CDATA[DELETE FROM CM_BUILDFACE P WHERE P.FACE_PID IN (SELECT T.PID FROM TEMP_CM_BUILDFACE T  ); ]]></sql>
            <sql><![CDATA[DELETE FROM CM_BUILDFACE_TOPO P WHERE P.FACE_PID IN (SELECT T.PID FROM TEMP_CM_BUILDFACE T  ); ]]></sql>
			<sql><![CDATA[DELETE FROM CM_BUILDING P WHERE P.PID IN (SELECT T.PID FROM TEMP_CM_BUILDING T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CM_BUILDLINK P WHERE P.LINK_PID IN (SELECT T.PID FROM TEMP_CM_BUILDLINK T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CM_BUILDLINK_MESH P WHERE P.LINK_PID IN (SELECT T.PID FROM TEMP_CM_BUILDLINK T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CM_BUILDNODE P WHERE P.NODE_PID IN (SELECT T.PID FROM TEMP_CM_BUILDNODE T ); ]]></sql>
            <sql><![CDATA[DELETE FROM CM_BUILDNODE_MESH P WHERE P.NODE_PID IN (SELECT T.PID FROM TEMP_CM_BUILDNODE T ); ]]></sql>
        
        </step>

        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_CM_BUILDFACE
					  SELECT FACE_PID
					    FROM CM_BUILDFACE A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM CM_BUILDFACE  B WHERE A.FACE_PID = B.FACE_PID);
				]]></sql>

            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_CM_BUILDING
					  SELECT PID
					    FROM CM_BUILDING A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM CM_BUILDING  B WHERE A.PID = B.PID);
				]]></sql>

            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_CM_BUILDLINK
					  SELECT LINK_PID
					    FROM CM_BUILDLINK A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM CM_BUILDLINK  B WHERE A.LINK_PID = B.LINK_PID);
				]]></sql>

            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_CM_BUILDNODE
					  SELECT NODE_PID
					    FROM CM_BUILDNODE A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM CM_BUILDNODE  B WHERE A.NODE_PID = B.NODE_PID);
				]]></sql>
        </step>

    </feature>

</sqls>