<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <!--索引：POI-->
    <import file="exp-poi-g.xml"/>

    <!--索引：文字表 -->
	<feature name="IX_ANNOTATION">
		<step value="7">
			<sql condition="polygon">
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_IX_ANNOTATION
                          (PID)
                          (SELECT PID FROM IX_ANNOTATION P
                    WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE');
                        ]]></sql>
		</step>

		<step value="100">
			<sql><![CDATA[SELECT P.* FROM IX_ANNOTATION P, TEMP_IX_ANNOTATION T WHERE P.PID = T.PID; ]]></sql>
			<sql><![CDATA[SELECT P.* FROM IX_ANNOTATION_NAME P, TEMP_IX_ANNOTATION T WHERE P.PID = T.PID;]]></sql>
			<sql><![CDATA[SELECT P.* FROM IX_ANNOTATION_FLAG P, TEMP_IX_ANNOTATION T WHERE P.PID = T.PID;]]></sql>
		</step>

		<step value="101">
			<sql><![CDATA[DELETE FROM IX_ANNOTATION P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_ANNOTATION T);]]></sql>
			<sql><![CDATA[DELETE FROM IX_ANNOTATION_NAME P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_ANNOTATION T ); ]]></sql>
			<sql><![CDATA[DELETE FROM IX_ANNOTATION_FLAG P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_ANNOTATION T ); ]]></sql>
		</step>

		<step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_IX_ANNOTATION
					  SELECT PID
					    FROM IX_ANNOTATION A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_ANNOTATION  B WHERE A.PID = B.PID);
				]]></sql>
        </step>

	</feature>
    
    <!--点门牌-->
    <feature name="IX_POINTADDRESS">
        <step value="7">
            <sql condition="polygon">
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_FILTER_IX_POINTADDRESS
                          (PID)
                          (SELECT PID FROM IX_POINTADDRESS
                            WHERE SDO_ANYINTERACT(GEOMETRY,
                                              [polygon]) = 'TRUE');
                        ]]></sql>

        </step>
        <step value="13">
            <!--父子关系-->
            <sql>
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_IX_POINTADDRESS_GROUP
                          (PID)
                          (  SELECT DISTINCT P.GROUP_ID
                               FROM IX_POINTADDRESS_PARENT P, TEMP_FILTER_IX_POINTADDRESS T
                              WHERE P.PARENT_PA_PID = T.PID
                          )
                          UNION 
                          (  SELECT DISTINCT P.GROUP_ID
                                FROM IX_POINTADDRESS_CHILDREN P, TEMP_FILTER_IX_POINTADDRESS T
                               WHERE P.CHILD_PA_PID = T.PID
                           );
                        ]]></sql>
        </step>

        <step value="22">
			<!--去重 -->
			<sql><![CDATA[TRUNCATE TABLE TEMP_IX_POINTADDRESS;]]></sql>
        </step>

        <step value="25">
            <!--去重 -->
			<sql>
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_IX_POINTADDRESS
                          (PID)
                          (SELECT DISTINCT PID FROM TEMP_FILTER_IX_POINTADDRESS P);
                        ]]></sql>
        </step>

        <step value="100">
            <sql><![CDATA[SELECT P.* FROM IX_POINTADDRESS P,TEMP_IX_POINTADDRESS T WHERE P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM IX_POINTADDRESS_FLAG P,TEMP_IX_POINTADDRESS T WHERE P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM IX_POINTADDRESS_NAME P,TEMP_IX_POINTADDRESS T WHERE P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM IX_POINTADDRESS_NAME_TONE P,(SELECT P.NAME_ID FROM IX_POINTADDRESS_NAME P,TEMP_IX_POINTADDRESS T WHERE P.PID=T.PID) T WHERE P.NAME_ID=T.NAME_ID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM IX_POINTADDRESS_PARENT P,TEMP_IX_POINTADDRESS_GROUP T WHERE P.GROUP_ID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM IX_POINTADDRESS_CHILDREN P,TEMP_IX_POINTADDRESS_GROUP T WHERE P.GROUP_ID=T.PID;]]></sql>
        </step>

        <step value="101">
            <sql><![CDATA[DELETE FROM IX_POINTADDRESS P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_POINTADDRESS T ); ]]></sql>
            <sql><![CDATA[DELETE FROM IX_POINTADDRESS_FLAG P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_POINTADDRESS T ); ]]></sql>
            <sql><![CDATA[DELETE FROM IX_POINTADDRESS_NAME P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_POINTADDRESS T ); ]]></sql>
            <sql><![CDATA[DELETE FROM IX_POINTADDRESS_NAME_TONE P WHERE P.NAME_ID IN (SELECT P.NAME_ID FROM IX_POINTADDRESS_NAME P, TEMP_IX_POINTADDRESS T WHERE P.PID = T.PID) ;]]></sql>
            <sql><![CDATA[DELETE FROM IX_POINTADDRESS_PARENT P WHERE P.GROUP_ID IN (SELECT T.PID FROM TEMP_IX_POINTADDRESS_GROUP T ); ]]></sql>
            <sql><![CDATA[DELETE FROM IX_POINTADDRESS_CHILDREN P WHERE P.GROUP_ID IN (SELECT T.PID FROM TEMP_IX_POINTADDRESS_GROUP T ); ]]></sql>
        </step>

        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_IX_POINTADDRESS
					  SELECT PID
					    FROM IX_POINTADDRESS A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_POINTADDRESS  B WHERE A.PID = B.PID);
				]]></sql>

				<sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_IX_POINTADDRESS_GROUP
					  SELECT GROUP_ID
					    FROM IX_POINTADDRESS_PARENT A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_POINTADDRESS_PARENT  B WHERE A.GROUP_ID = B.GROUP_ID);
				]]></sql>
        </step>
    </feature>
    
    <!--HAMLET索引-->
    <feature name="IX_HAMLET">
        <step value="7">
            <sql condition="polygon">
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_IX_HAMLET
                          (PID)
                          (SELECT PID FROM IX_HAMLET
                            WHERE SDO_ANYINTERACT(GEOMETRY,
                                              [polygon]) = 'TRUE');
                        ]]></sql>

        </step>

        <step value="100">
            <sql><![CDATA[SELECT P.* FROM IX_HAMLET P,TEMP_IX_HAMLET T WHERE P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM IX_HAMLET_NAME P,TEMP_IX_HAMLET T WHERE P.PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM IX_HAMLET_NAME_TONE P,(SELECT P.NAME_ID FROM IX_HAMLET_NAME P,TEMP_IX_HAMLET T WHERE P.PID=T.PID) T WHERE P.NAME_ID=T.NAME_ID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM IX_HAMLET_FLAG P,TEMP_IX_HAMLET T WHERE P.PID=T.PID;]]></sql>
        </step>

        <step value="101">
            <sql><![CDATA[DELETE FROM IX_HAMLET P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_HAMLET T ); ]]></sql>
            <sql><![CDATA[DELETE FROM IX_HAMLET_NAME P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_HAMLET T ); ]]></sql>
            <sql><![CDATA[DELETE FROM IX_HAMLET_FLAG P WHERE P.PID IN (SELECT T.PID FROM TEMP_IX_HAMLET T ); ]]></sql>
            <sql><![CDATA[DELETE FROM IX_HAMLET_NAME_TONE P WHERE P.NAME_ID IN (SELECT P.NAME_ID FROM IX_HAMLET_NAME P, TEMP_IX_HAMLET T WHERE P.PID = T.PID);]]></sql>
        </step>

        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_IX_HAMLET
					  SELECT PID
					    FROM IX_HAMLET A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_HAMLET  B WHERE A.PID = B.PID);
				]]></sql>
        </step>
    </feature>
    
    <!--IC出入口索引-->
    <feature name="IX_IC">
        <step value="100">
            <sql condition="polygon"><![CDATA[SELECT P.* FROM IX_IC P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>

        <step value="101">
            <sql condition="polygon"><![CDATA[DELETE FROM IX_IC P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>

        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					DELETE
					    FROM IX_IC A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_IC  B WHERE A.PID = B.PID);
				]]></sql>
        </step>
    </feature>
    
    <!--交叉点索引-->
    <feature name="IX_CROSSPOINT">
        <step value="100">
            <sql condition="polygon"><![CDATA[SELECT P.* FROM IX_CROSSPOINT P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>
        <step value="101">
            <sql condition="polygon"><![CDATA[DELETE FROM IX_CROSSPOINT P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>

        </step>
        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					DELETE
					    FROM IX_CROSSPOINT A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_CROSSPOINT  B WHERE A.PID = B.PID);
				]]></sql>
        </step>
    </feature>
    
    <!--收费站索引-->
    <feature name="IX_TOLLGATE">
        <step value="100">
            <sql condition="polygon"><![CDATA[SELECT P.* FROM IX_TOLLGATE P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>
        <step value="101">
            <sql condition="polygon"><![CDATA[DELETE FROM IX_TOLLGATE P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>
        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					DELETE
					    FROM IX_TOLLGATE A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_TOLLGATE  B WHERE A.PID = B.PID);
				]]></sql>
        </step>
    </feature>

    <!--道路名索引-->
    <feature name="IX_ROADNAME">
        <step value="100">
            <sql condition="polygon"><![CDATA[SELECT P.* FROM IX_ROADNAME P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>
        <step value="101">
            <sql condition="polygon"><![CDATA[DELETE FROM IX_ROADNAME P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>
        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					DELETE
					    FROM IX_ROADNAME A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_ROADNAME  B WHERE A.PID = B.PID);
				]]></sql>
        </step>
    </feature>
    
    <!--邮编-->
    <feature name="IX_POSTCODE">
        <step value="100">
            <sql condition="polygon"><![CDATA[SELECT P.* FROM IX_POSTCODE P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>

        <step value="101">
            <sql condition="polygon"><![CDATA[DELETE FROM IX_POSTCODE P WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE';]]></sql>
        </step>

        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					DELETE
					    FROM IX_POSTCODE A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM IX_POSTCODE  B WHERE A.POST_ID = B.POST_ID);
				]]></sql>
        </step>
    </feature>
</sqls>