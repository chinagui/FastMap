<?xml version="1.0" encoding="UTF-8"?>
<!-- 
@authur:liuqing @time:2012-2-20 提取外业POI -->
<sqls>



	<feature name="IX_POI">
		<step value="1">
			<sql><![CDATA[TRUNCATE TABLE TEMP_IX_POI;]]></sql>
			<sql><![CDATA[TRUNCATE TABLE TEMP_IX_SAMEPOI;]]></sql>
			<sql><![CDATA[TRUNCATE TABLE TEMP_IX_POI_GROUP;]]></sql>
		</step>
		<!-- 外业成果POI导出: 1.根据meshId提取 -->
		<step value="7">
			<!--按图幅过滤IX_POI -->
			<sql>
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_IX_POI
                          (PID)
                          (SELECT AUDATA_ID FROM AU_IX_POI WHERE KIND_CODE [kind] AND (GEO_OPRSTATUS in (0,1) OR ATT_OPRSTATUS in (0,1)));
                        ]]></sql>
		</step>




		<!--查询group并去重 -->
		<step value="22">
			<sql>
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_IX_POI_GROUP
                          (PID)
                          (  SELECT DISTINCT P.GROUP_ID
                               FROM AU_IX_POI_PARENT P, TEMP_IX_POI T
                              WHERE P.AUDATA_ID = T.PID
                          );
                        ]]></sql>

		</step>

		<step value="100">
			<!-- 提取POI信息: 1. IX_POI 2. IX_POI_CONTACT 3. IX_POI_CHILDREN 4. IX_POI_PARENT 
				5. IX_POI_NAME 6. IX_POI_ADDRESS 7. IX_POI_ICON 8. IX_POI_PHOTO 9. IX_POI_NODE 
				10. IX_SAMEPOI 11. IX_SAMEPOI_PART  -->
			<!--IX_POI -->
			<sql><![CDATA[SELECT P.* FROM AU_IX_POI P,TEMP_IX_POI T WHERE P.AUDATA_ID=T.PID;]]></sql>
			<!--IX_POI_CONTACT -->
			<sql><![CDATA[SELECT P.* FROM AU_IX_POI_CONTACT P,TEMP_IX_POI T WHERE P.AUDATA_ID=T.PID;]]></sql>
			<!--IX_POI_CHILDREN -->
			<sql><![CDATA[
                          SELECT P.*
                            FROM AU_IX_POI_CHILDREN P, TEMP_IX_POI_GROUP T
                           WHERE P.GROUP_ID = T.PID
                           AND P.AUDATA_ID IN (SELECT PID FROM TEMP_IX_POI);
                         ]]></sql>
			<!--IX_POI_PARENT -->
			<sql><![CDATA[
                          SELECT P.*
                            FROM AU_IX_POI_PARENT P, TEMP_IX_POI_GROUP T
                           WHERE (P.GROUP_ID = T.PID);
                         ]]></sql>
			<!--IX_POI_NAME -->
			<sql><![CDATA[SELECT P.* FROM AU_IX_POI_NAME P,TEMP_IX_POI T WHERE P.AUDATA_ID=T.PID;]]></sql>
			<!--IX_POI_ADDRESS -->
			<sql><![CDATA[SELECT P.* FROM AU_IX_POI_ADDRESS P,TEMP_IX_POI T WHERE P.AUDATA_ID=T.PID;]]></sql>


			<sql><![CDATA[SELECT P.* FROM AU_IX_POI_RESTAURANT P,TEMP_IX_POI T WHERE P.AUDATA_ID=T.PID;]]></sql>



		</step>

	</feature>

	<import file="table-stats-exp-proxypoi-au-main.xml"/>


</sqls>