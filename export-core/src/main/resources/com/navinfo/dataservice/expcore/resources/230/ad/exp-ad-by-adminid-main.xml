<?xml version="1.0" encoding="UTF-8"?>
<!--
@authur:liuqing
@time:2010-11-24
-->
<sqls>
    <!--///////////////////////////////////////////////////行政区划/////////////////////////////////////////////////////////-->
    <feature name="AD_ADMIN">
        <!--
            行政区划提取原则:
            1).根据行政区划号码导出Admin数据（并且导出该行政区划上级行政区划，直到省级行政区划）
            1).根据行政区划号码导出行政区划面（并且导出该行政区划面上级行政区划面，直到省级行政区划面）
            1).根据行政区划对应图幅导出POI（基本信息+ 名称），主要是AOI等需要，并且导出POI关联LINK
            1).根据行政区划对应图幅导出道路LINK基本信息、名称。
            1).根据行政区划对应图幅导出铁路。
            1).根据行政区划对应图幅导出土地利用、土地覆盖面。
            2).导出数据立交、同一关系。
            注：NaviCMS提交任务时，需要提交行政区划号码和行政区划号码对应图幅列表

        -->
        <step value="7">
            <!--按admin_id提取-->
            <sql><![CDATA[
                     INSERT /*+ append */
                     INTO TEMP_AD_ADMIN_RG
                       (PID)
                       (SELECT A.REGION_ID FROM AD_ADMIN A WHERE A.ADMIN_ID [adminid]);
                     ]]></sql>
        </step>
        <step value="10">
            <!--查询关联的行政区划的父对象-->
            <sql><![CDATA[
                    INSERT /*+ APPEND */
                    INTO TEMP_AD_ADMIN_RG
                      (PID)
                      (SELECT REGION_ID
                         FROM VIEW_AD_ADMIN
                       CONNECT BY NOCYCLE PRIOR REGION_ID_UP = REGION_ID
                        START WITH REGION_ID IN (SELECT PID FROM TEMP_AD_ADMIN_RG));
                         ]]></sql>
        </step>
        <step value="13">
            <sql>
                <![CDATA[
                    DELETE FROM TEMP_AD_ADMIN_RG A
                    WHERE A.ROWID !=
                           (SELECT MAX(B.ROWID) FROM TEMP_AD_ADMIN_RG B WHERE A.PID = B.PID);
                    ]]></sql>

        </step>

        <step value="16">
            <!--按提取face-->
            <sql>
                <![CDATA[
                     INSERT /*+ append */
                     INTO TEMP_AD_FACE
                       (PID)
                       (SELECT  F.FACE_PID FROM AD_FACE F,TEMP_AD_ADMIN_RG T  WHERE F.REGION_ID=T.PID);
                     ]]></sql>
        </step>
        <step value="19">
            <!--根据face提取link，并去重-->
            <sql><![CDATA[
                         INSERT /*+ append */
                         INTO TEMP_AD_LINK
                           (PID)
                           (SELECT DISTINCT T.LINK_PID
                              FROM TEMP_AD_FACE P, AD_FACE_TOPO T
                             WHERE P.PID = T.FACE_PID);
                         ]]></sql>

        </step>
        <step value="22">
            <!--查询AD_LINK的两端端点并去重-->
            <sql><![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_AD_NODE
                          (PID)
                          (SELECT P.S_NODE_PID FROM AD_LINK P, TEMP_AD_LINK T WHERE P.LINK_PID = T.PID
                             UNION
                           SELECT P.E_NODE_PID FROM AD_LINK P, TEMP_AD_LINK T WHERE P.LINK_PID = T.PID
                           );
                        ]]></sql>

        </step>


    </feature>
    <import file="exp-ad_select.xml"/>
    <import file="table-stats-exp-ad-adminid.xml"/>
</sqls>