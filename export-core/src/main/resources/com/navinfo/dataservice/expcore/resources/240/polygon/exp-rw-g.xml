<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <!--///////////////////////////////////////////////////铁路/////////////////////////////////////////////////////////-->
    <feature name="RW_LINK_FILTER">
        <step value="7">
            <sql condition="polygon">
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_FILTER_RW_LINK
                          (PID)
                          (SELECT LINK_PID FROM RW_LINK WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE');
                        ]]></sql>
        </step>
    </feature>

    <feature name="RW_NODE_FILTER">
        <step value="7">
            <sql condition="polygon">
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_FILTER_RW_NODE
                          (PID)
                          (SELECT NODE_PID FROM RW_NODE WHERE SDO_ANYINTERACT(GEOMETRY,[polygon]) = 'TRUE');
                        ]]></sql>
        </step>
    </feature>

    <feature name="RW_FEATURE">

        <step value="13">
            <!--根据link提取RW_FEATURE，并去重-->
            <sql>
                <![CDATA[
                        INSERT /*+ append */
                        INTO TEMP_RW_FEATURE
                          (PID)
                          (SELECT DISTINCT CN.FEATURE_PID
                             FROM TEMP_FILTER_RW_LINK N, RW_LINK CN
                            WHERE N.PID = CN.LINK_PID
                            AND CN.FEATURE_PID!=0 AND CN.FEATURE_PID!=-1);
                        ]]></sql>
        </step>

        <step value="31">
            <sql><![CDATA[
                         INSERT /*+ append */
                         INTO TEMP_RD_LINK_NAMEID
                           (PID)
                           (SELECT P.NAME_ID
                              FROM RD_NAME P
                             WHERE EXISTS (SELECT P1.NAME_GROUPID FROM RW_LINK_NAME P1,TEMP_FILTER_RW_LINK T1 WHERE P1.LINK_PID=T1.PID AND P.NAME_GROUPID = P1.NAME_GROUPID));
                         ]]></sql>
        </step>

        <step value="100">
            <!--提取铁路信息:
                1. RW_FEATURE
                2. RW_LINK
                3. RW_LINK_NAME
                4. RW_NODE
                5. RW_NODE_MESH
            -->
            <sql><![CDATA[SELECT P.* FROM RW_FEATURE P,TEMP_RW_FEATURE T WHERE P.FEATURE_PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM RW_LINK P,TEMP_FILTER_RW_LINK T WHERE P.LINK_PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM RW_LINK_NAME P,TEMP_FILTER_RW_LINK T WHERE P.LINK_PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM RW_NODE P,TEMP_FILTER_RW_NODE T WHERE P.NODE_PID=T.PID;]]></sql>
            <sql><![CDATA[SELECT P.* FROM RW_NODE_MESH P,TEMP_FILTER_RW_NODE T WHERE P.NODE_PID=T.PID;]]></sql>
        </step>

        <step value="101">
            <!--删除铁路信息:
                1. RW_FEATURE
                2. RW_LINK
                3. RW_LINK_NAME
                4. RW_NODE
                5. RW_NODE_MESH
            -->
            <sql><![CDATA[DELETE FROM RW_FEATURE P WHERE P.FEATURE_PID IN (SELECT T.PID FROM TEMP_RW_FEATURE T ); ]]></sql>
            <sql><![CDATA[DELETE FROM RW_LINK P WHERE P.LINK_PID IN (SELECT T.PID FROM TEMP_FILTER_RW_LINK T ); ]]></sql>
            <sql><![CDATA[DELETE FROM RW_LINK_NAME P WHERE P.LINK_PID IN (SELECT T.PID FROM TEMP_FILTER_RW_LINK T ); ]]></sql>
            <sql><![CDATA[DELETE FROM RW_NODE P WHERE P.NODE_PID IN (SELECT T.PID FROM TEMP_FILTER_RW_NODE T ); ]]></sql>
            <sql><![CDATA[DELETE FROM RW_NODE_MESH P WHERE P.NODE_PID IN (SELECT T.PID FROM TEMP_FILTER_RW_NODE T ); ]]></sql>
        </step>

        <step value="102">
            <!--查找重复信息：-->
            <sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_RW_FEATURE
					  SELECT FEATURE_PID
					    FROM RW_FEATURE A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM RW_FEATURE  B WHERE A.FEATURE_PID = B.FEATURE_PID);
				]]></sql>

			<sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_FILTER_RW_LINK
					  SELECT LINK_PID
					    FROM RW_LINK A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM RW_LINK  B WHERE A.LINK_PID = B.LINK_PID);
				]]></sql>

			<sql><![CDATA[
					INSERT /*+ append */ INTO TEMP_FILTER_RW_NODE
					  SELECT NODE_PID
					    FROM RW_NODE A
					   WHERE A.ROWID !=
					         (SELECT MAX(B.ROWID) FROM RW_NODE  B WHERE A.NODE_PID = B.NODE_PID);
				]]></sql>
        </step>
    </feature>
</sqls>